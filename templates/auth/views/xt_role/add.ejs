<style rel="stylesheet">
  body {
    padding: 10px;
  }
</style>
<div class="container">
  <form class="layui-form layui-form-pane" action="">
    <% if (role.id) { %>
    <input type="hidden" value="<%= role.id %>" name="id">
    <% } %>
    <div class="layui-form-item">
      <label class="layui-form-label">角色名</label>
      <div class="layui-input-block">
        <input type="text" name="name" required lay-verify="name" value="<%= role.name ? role.name : '' %>" placeholder="请输入角色名" autocomplete="off" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">排序号</label>
      <div class="layui-input-block">
        <input type="number" name="sorted_num" required value="<%= role.sorted_num %>" lay-verify="sorted_num" placeholder="请输入排序号" autocomplete="off" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item" style="text-align: center;">
      <button class="layui-btn" lay-submit lay-filter="submit_btn">保存</button>
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
  </form>
</div>

<script type="text/javascript">

  layui.use('form', function(){
    var form = layui.form, $ = layui.jquery;

    form.verify({
      name: function (value, item) {
        if (value.trim().length === 0) {
          return '角色名不能为空!';
        }
      },
      sorted_num: function (value, item) {
        if (value.trim().length === 0) {
          return;
        }
        var reg = new RegExp("^[0-9]*$");
        if(reg.test(value.trim())) {
          return;
        }
        return '排序号为正整数';
      }
    });

    //监听提交
    form.on('submit(submit_btn)', function(data) {
      var loading = layer.load(1);
      $.post('/admin/xt_role/add', data.field, function(data) {
        layer.close(loading);
        if (data.errCode === 0) {
          layer.msg(data.msg, {
            icon: 6,
            time: 2000
          }, function() {
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭
          });
        } else {
          layer.msg(data.msg, {icon: 5});
        }
      });

      return false;
    });
  });
</script>