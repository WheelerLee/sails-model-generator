<link rel="stylesheet" href="/admin/css/main.css">
<script type="text/javascript" src="/admin/js/index.js"></script>
<div class="layui-layout layui-layout-admin">

  <div class="layui-header header ">
    <div class="layui-main">
      <a href="#" class="logo">后台管理系统</a>
      <!-- 天气信息 -->
      <div class="weather" pc>
        <div id="tp-weather-widget"></div>
        <script>(function (T, h, i, n, k, P, a, g, e) {
            g = function () {
              P = h.createElement(i);
              a = h.getElementsByTagName(i)[0];
              P.src = k;
              P.charset = "utf-8";
              P.async = 1;
              a.parentNode.insertBefore(P, a)
            };
            T["ThinkPageWeatherWidgetObject"] = n;
            T[n] || (T[n] = function () {
              (T[n].q = T[n].q || []).push(arguments)
            });
            T[n].l = +new Date();
            if (T.attachEvent) {
              T.attachEvent("onload", g)
            } else {
              T.addEventListener("load", g, false)
            }
          }(window, document, "script", "tpwidget", "//widget.seniverse.com/widget/chameleon.js"))</script>
        <script>tpwidget("init", {
            "flavor": "slim",
            "location": "WX4FBXXFKE4F",
            "geolocation": "enabled",
            "language": "zh-chs",
            "unit": "c",
            "theme": "chameleon",
            "container": "tp-weather-widget",
            "bubble": "disabled",
            "alarmType": "badge",
            "color": "#FFFFFF",
            "uid": "U9EC08A15F",
            "hash": "039da28f5581f4bcb5c799fb4cdfb673"
          });
          tpwidget("show");</script>
      </div>
      <!-- 顶部右侧菜单 -->
      <ul class="layui-nav top_menu">
        <li class="layui-nav-item">
          <a href="javascript:;">
            <img id="tool_head_icon" src="<%= down_path + userInfo.head_icon %>"
                 onerror="this.src='/images/default.jpeg'"
                 class="layui-circle" width="35" height="35">
            <cite><%= userInfo.nick_name %></cite>
          </a>
          <dl class="layui-nav-child">
            <dd>
              <a href="javascript:;" id="info">
                <i class="iconfont icon-zhanghu" data-icon="icon-zhanghu"></i>
                <cite>个人资料</cite>
              </a>
            </dd>
            <dd>
              <a href="javascript:;" id="change_pwd_btn">
                <i class="iconfont icon-shezhi1" data-icon="icon-shezhi1"></i>
                <cite>修改密码</cite>
              </a>
            </dd>
            <dd>
              <a href="/admin/user/logout" class="signOut">
                <i class="iconfont icon-loginout"></i>
                <cite>退出</cite>
              </a>
            </dd>
          </dl>
        </li>
      </ul>
    </div>
  </div>

  <div class="layui-side layui-bg-black">
    <div class="user-photo">
      <a class="img" title="我的头像" id="user_head_icon" style="position: relative;"  >
        <img src="<%= down_path + userInfo.head_icon %>" onerror="this.src='/images/default.jpeg'">
      </a>
      <p>你好！<span class="userName"><%= userInfo.nick_name %></span>, 欢迎登录</p>
    </div>
    <ul id="menu_tree" class="layui-nav layui-nav-tree" lay-filter="test">
      <% _.each(resources, function (resource) { %>
      <% if (!resource.sub_resources || resource.sub_resources.length === 0) { %>
      <li class="layui-nav-item">
        <a href="javascript:;" _href="<%= resource.path %>">
          <i class="layui-icon" style="font-size: 14px; margin-right: 8px;"><%= resource.icon_path %></i>
          <%= resource.name %>
        </a>
      </li>
      <% } else { %>
      <li class="layui-nav-item">
        <a href="javascript:;">
          <i class="layui-icon" style="font-size: 14px; margin-right: 8px;"><%= resource.icon_path %>
          </i><%= resource.name%>
        </a>
        <dl class="layui-nav-child">
          <% _.each(resource.sub_resources, function (sub_resource) { %>
          <dd>
            <a href="javascript:;" _href="<%= sub_resource.path %>">
              <i class="layui-icon" style="font-size: 14px; margin-right: 8px;"><%= sub_resource.icon_path %></i>
              <%= sub_resource.name %>
            </a>
          </dd>
          <% }) %>
        </dl>
      </li>
      <% } %>
      <% }) %>
    </ul>
  </div>

  <div class="layui-body layui-form">
    <div class="layui-tab layui-tab-brief" style="margin: 0;" lay-filter="bodyTab" id="top_tabs_box">
      <ul class="layui-tab-title" id="top_tabs">
        <li class="layui-this" lay-allowclose="false">首页</li>
      </ul>
      <ul class="layui-nav closeBox layui-bg-molv" lay-filter="caozuo">
        <li class="layui-nav-item">
          <a href="javascript:;">页面操作</a>
          <dl class="layui-nav-child">
            <dd><a href="javascript:;" class="refresh refreshThis"><i class="layui-icon">&#x1002;</i> 刷新当前</a></dd>
            <dd><a href="javascript:;" class="closePageOther"><i class="iconfont icon-prohibit"></i> 关闭其他</a></dd>
            <dd><a href="javascript:;" class="closePageAll"><i class="iconfont icon-guanbi"></i> 关闭全部</a></dd>
          </dl>
        </li>
      </ul>
      <div class="layui-tab-content clildFrame">
        <div class="layui-tab-item layui-show">
          <iframe src="/admin/home/welcome"></iframe>
        </div>
      </div>
    </div>
  </div>

</div>
<script>
  layui.use('upload', function(){
    var upload = layui.upload;$ = layui.jquery;
    var down_path = '<%= down_path%>';
    //执行实例
    var uploadInst = upload.render({
      elem: '#user_head_icon', //绑定元素
      url: '<%= upload_path %>', //上传接口
      done: function(res) {
        //上传完毕回调
        if(res){
          $("#user_head_icon").children("img:first").attr("src", down_path + res.id);
          $("#tool_head_icon").attr('src', down_path + res.id);
          $.post("/admin/home/userInfo", {head_icon: res.id}, function (result) {
            if(result){
              layer.open({
                title: '提示',
                content: '修改成功!'
              });
            }
          });
        }
      }

    });
  });
</script>
