<style rel="stylesheet">
  body {
    padding: 10px;
  }
</style>
<div class="container">
  <form class="layui-form layui-form-pane" action="">
    <% if (manager.id) { %>
    <input type="hidden" value="<%= manager.id %>" name="id">
    <% } %>
    <div class="layui-form-item">
      <label class="layui-form-label">姓名</label>
      <div class="layui-input-block">
        <input type="text" name="name" required lay-verify="name" value="<%= manager.name ? manager.name : '' %>" placeholder="请输入姓名" autocomplete="off" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">昵称</label>
      <div class="layui-input-block">
        <input type="text" name="nick_name" required lay-verify="nick_name" value="<%= manager.nick_name ? manager.nick_name : '' %>" placeholder="请输入昵称" autocomplete="off" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">登录名</label>
      <div class="layui-input-block">
        <input type="text" name="login_name" required lay-verify="login_name" value="<%= manager.login_name ? manager.login_name : '' %>" placeholder="请输入登录名" autocomplete="off" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">密码</label>
      <div class="layui-input-block">
        <input type="password" name="password" lay-verify="password" value="" placeholder="<%= manager.id ? '如需重置密码请填写' : '请输入密码' %>" autocomplete="new-password" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">所属角色</label>
      <div class="layui-input-block">
        <select name="user_role" lay-verify="user_role">
          <option value="">请选择</option>
          <% _.each(roles, function (role) { %>
          <option value="<%= role.id %>" <%= role.id === user_role.role_id ? 'selected' : '' %>><%= role.name %></option>
          <% }) %>
        </select>
      </div>
    </div>
    <div class="layui-form-item layui-form-text">
      <label class="layui-form-label">个人介绍</label>
      <div class="layui-input-block">
        <textarea class="layui-textarea" name="descriptions" lay-verify="content" id="descriptions" placeholder="个人介绍" ><%= manager.descriptions ? manager.descriptions : "" %></textarea>
      </div>
    </div>
    <div class="layui-form-item" style="text-align: center;">
      <button class="layui-btn" lay-submit lay-filter="submit_btn">保存</button>
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
  </form>
</div>

<script type="text/javascript">

  layui.use('form', function(){
    var form = layui.form, $ = layui.jquery;

    form.verify({
      name: function (value, item) {
        if (value.trim().length === 0) {
          return '姓名不能为空!';
        }
      },
      nick_name: function (value, item) {
        if (value.trim().length === 0) {
          return '昵称不能为空!';
        }
      },
      login_name: function (value, item) {
        if (value.trim().length === 0) {
          return '登录名不能为空!';
        }
      },
      password: function (value, item) {
        <% if (manager.id) { %>
        if ((value.length < 6 || value.length > 18) && value.length !== 0) {
          return '密码长度为6-18位， 如不要重置密码，请不要填写密码。';
        }
        <% } else { %>
        if (value.length < 6 || value.length > 18) {
          return '密码长度为6-18位!';
        }
        <% } %>
      },
      user_role: function (value, item) {
        if (!value) {
          return '请选择所属的角色';
        }
      }
    });

    //监听提交
    form.on('submit(submit_btn)', function(data) {
      var loading = layer.load(1);
      $.post('/admin/manager/add', data.field, function(data) {
        layer.close(loading);
        if (data.errCode === 0) {
          layer.msg(data.msg, {
            icon: 6,
            time: 2000
          }, function() {
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭
          });
        } else {
          layer.msg(data.msg, {icon: 5});
        }
      });

      return false;
    });
  });
</script>