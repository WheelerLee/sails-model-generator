<style rel="stylesheet">
  body {
    padding: 10px;
  }
</style>
<div class="container">
  <form class="layui-form layui-form-pane" action="">
    <%- '\<\% if (' + modelName.toLowerCase() + '.' + primaryKey + ') { \%\>' %>
    <input type="hidden" value="<%- '\<\%= ' + modelName.toLowerCase() + '.' + primaryKey + ' \%\>' %>" name="<%= primaryKey %>">
    <%- '\<\% } \%\>' %>

    <%_ for (var i in model.attributes) { _%>
    <%_ var attribute = model.attributes[i] _%>
    <%_ if (!attribute.type) {continue} _%>
    <%_ if (i !== primaryKey) { _%>
    <div class="layui-form-item">
      <label class="layui-form-label"><%= attribute.name ? attribute.name : i %></label>
      <div class="layui-input-block">
        <input type="text" name="<%= i %>" lay-verify="<%= i %>"
               value="<%- '\<\%= ' + modelName.toLowerCase() + '.' + i + ' ? ' + modelName.toLowerCase() + '.' + i + ' : \'\' \%\>' %>" placeholder="请输入<%= attribute.name ? attribute.name : i %>" autocomplete="off" class="layui-input">
      </div>
    </div>
    <%_ } _%>
    <%_ } _%>
    <div class="layui-form-item" style="text-align: center;">
      <button class="layui-btn" lay-submit lay-filter="submit_btn">保存</button>
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
  </form>
</div>

<script type="text/javascript">

  layui.use('form', function(){
    var form = layui.form, $ = layui.jquery;

    form.verify({
      <%_ for (var i in model.attributes) { _%>
      <%_ var attribute = model.attributes[i] _%>
      <%_ if (!attribute.type) {continue} _%>
      <%_ if (i !== primaryKey) { _%>
      <%= i %>: function (value, item) {
        <%_ if (attribute.alpha) { _%>
        var reg = /^[a-zA-Z]+$/;
        if(!reg.test(value.trim())) {
          return '<%= attribute.name ? attribute.name : i %>只能包含字母';
        }
        <%_ } _%>
        <%_ if (attribute.alphadashed) { _%>
        var reg = /^[a-zA-Z\-]+$/;
        if(!reg.test(value.trim())) {
          return '<%= attribute.name ? attribute.name : i %>只能包含字母以及中划线-';
        }
        <%_ } _%>
        <%_ if (attribute.alphanumeric) { _%>
        var reg = /^[a-zA-Z0-9]+$/;
        if(!reg.test(value.trim())) {
          return '<%= attribute.name ? attribute.name : i %>只能包含字母以及数字';
        }
        <%_ } _%>
        <%_ if (attribute.alphanumericdashed) { _%>
        var reg = /^[a-zA-Z0-9\-]+$/;
        if(!reg.test(value.trim())) {
          return '<%= attribute.name ? attribute.name : i %>只能包含字母，数字以及中划线-';
        }
        <%_ } _%>
        <%_ if (attribute.decimal || attribute.numeric || attribute.float || attribute.type === 'float') { _%>
        var reg = /^(\-|\+)?\d+(\.\d+)?$/;
        if(!reg.test(value.trim())) {
          return '<%= attribute.name ? attribute.name : i %>必须是数字';
        }
        <%_ } _%>
        <%_ if (attribute.email) { _%>
        var reg = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
        if(!reg.test(value.trim())) {
          return '<%= attribute.name ? attribute.name : i %>必须是邮箱';
        }
        <%_ } _%>
        <%_ if (attribute.int || attribute.integer || attribute.type === 'integer') { _%>
        var reg = /^[0-9]+$/;
        if(!reg.test(value.trim())) {
          return '<%= attribute.name ? attribute.name : i %>必须是整数';
        }
        <%_ } _%>
        <%_ if (attribute.is || attribute.regex) { _%>
        var reg = <%= attribute.is || attribute.regex %>;
        if(!reg.test(value.trim())) {
          return '<%= attribute.name ? attribute.name : i %>格式错误';
        }
        <%_ } _%>
        <%_ if (attribute.lowercase) { _%>
        var reg = /^[a-z]+$/;
        if(!reg.test(value.trim())) {
          return '<%= attribute.name ? attribute.name : i %>只能包含小写字母';
        }
        <%_ } _%>
        <%_ if (attribute.uppercase) { _%>
        var reg = /^[A-Z]+$/;
        if(!reg.test(value.trim())) {
          return '<%= attribute.name ? attribute.name : i %>只能包含大写字母';
        }
        <%_ } _%>
        <%_ if (attribute.int || attribute.integer || attribute.type === 'integer' || attribute.decimal || attribute.numeric || attribute.float || attribute.type === 'float') { _%>
        <%_ if (attribute.max || attribute.max === 0) { _%>
        if (parseFloat(value) > <%= attribute.max %>) {
          return '<%= attribute.name ? attribute.name : i %>不能大于<%= attribute.max %>';
        }
        <%_ } _%>
        <%_ if (attribute.min || attribute.min === 0) { _%>
        if (parseFloat(value) < <%= attribute.min %>) {
          return '<%= attribute.name ? attribute.name : i %>不能小于<%= attribute.min %>';
        }
        <%_ } _%>
        <%_ } _%>
        <%_ if (attribute.type === 'string') { _%>
        <%_ if (attribute.minLength || attribute.minLength === 0) { _%>
        if (value.trim().length < <%= attribute.minLength %>) {
          return '<%= attribute.name ? attribute.name : i %>的长度必须大于<%= attribute.minLength %>';
        }
        <%_ } _%>
        <%_ if (attribute.maxLength || attribute.maxLength === 0) { _%>
        if (value.trim().length > <%= attribute.maxLength %>) {
          return '<%= attribute.name ? attribute.name : i %>的长度必须小于<%= attribute.maxLength %>';
        }
        <%_ } _%>
        <%_ } _%>
      },
      <%_ } _%>
      <%_ } _%>
    });

    //监听提交
    form.on('submit(submit_btn)', function(data) {
      var loading = layer.load(1);
      $.post('/<%= folderName %>/<%= modelName.toLowerCase() %>/add', data.field, function(data) {
        layer.close(loading);
        if (data.errCode === 0) {
          layer.msg(data.msg, {
            icon: 6,
            time: 2000
          }, function() {
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭
          });
        } else {
          layer.msg(data.msg, {icon: 5});
        }
      });

      return false;
    });
  });
</script>